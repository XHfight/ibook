# 网络层
* [网络层简介](#1)
* [IP地址与MAC地址](#2)
* [IP协议](#3)
* [路由](#4)  

<h2 id="2">IP地址与MAC地址</h2>

* mac地址: 出厂时已经固化在网卡的ROM中. <font color="red">全球唯一</font>,是48位物理地址,数据链路层和物理层使用的地址.   	 	
* IP地址 = 网络号+主机号,是32位逻辑地址,方便寻址.网络层及以上层使用的地址.  
 * IP地址__唯一性__  
 IP地址分为了公网地址和私网地址。公网地址就是互联网（Internet）上面的地址，全球唯一。私网地址只要在私网内唯一就可以了.   
 * 为什么电脑的IP地址一直在变?因为IP地址是动态获取的,IPV4地址数量有限
* 有了IP地址,为什么还要有mac地址?  
  1. 整体与局部:  
  	mac地址相当于下一跳地址;IP地址相当于终点地址.在数据转发过程中,mac地址会一直改变,它起到记录下一跳地址的作用.如果mac地址不发生改变则找不到下一跳的地址.   
    <注：一般来说IP地址经过路由器是不变的，不过NAT（Network address translation）例外>  
  2. 分层实现:  
  	其实在IP数据报中加一个字段表示下一跳IP地址,理论上说也如果IP地址够用,交换机也支持IP地址转发,其实mac地址并不是必要的,这样设计可以让网络层和数据链路层的协议更灵活,两层互不干扰,使分层更清晰,使每层可以灵活使用协议.  
    
<h2 id="3">IP协议</h2>  
- IP协议的作用:向上提无状态,无连接,不保证可靠性的传输服务.向下提供数据报的分片.  
	* 无状态:通信双方不同步传输数据的信息,数据的发送,传输,和接收相互独立,每个数据报之间没有上下文关系.  
	优点:不用同步传输双方的数居信息,简单,高效  
    缺点:无法知道对端的数据接收情况,无法处理数据报(分片之前)丢失,乱序和重复的问题.  
    * 无连接:IP通信双方不保存对方的任何信息.
    * 不可靠:可能出现出错,丢失,乱序,重复等情况.  
- 数据报内容实现的功能：  
1）报头与有效载荷分离 －－首部长度（Internet Header Length，IHL）、总长度字段  
2）分片与组合－－标识字段、标志位字段、片偏移字段  
3）不能无限转发－－生存时间（TTL：Time to Live）字段  
4）交付上层-－协议字段  
5）对首部校验－－首部校验和字段  
6）从哪来，去哪里－－源IP地址、目标IP地址字段
- IP数据报格式:  
   ![](picture/IP数据报格式.png) 
首部中固定部分的各个字段介绍：  
●版本（Version）字段：占4比特。用来表明IP协议实现的版本号，IPv4：4。  
●首部长度（Internet Header Length，IHL）字段：IP头部长度。 单位：4字节  （4位最多能表示15，所以IP头部最大为15*4＝60字节。）  
●服务类型（Type of Service ，TOS）字段：占8比特。3比特优先权子字段（Precedence，现已被忽略）＋4位TOS字段＋1位保留字段（必须置0）。4位TOS字段分别代表最小延迟、最大吞吐量、最高可靠性和最小花费。这4比特的服务类型中只能置其中1比特为1。可以全为0，若全为0则表示一般服务。服务类型字段声明了数据报被网络系统传输时可以被怎样处理。例如：TELNET协议可能要求有最小的延迟，FTP协议（数据）可能要求有最大吞吐量，SNMP协议可能要求有最高可靠性，NNTP（Network News Transfer Protocol，网络新闻传输协议）可能要求最小费用，而ICMP协议可能无特殊要求（4比特全为0）。实际上，大部分主机会忽略这个字段，但一些动态路由协议如OSPF（Open Shortest Path First Protocol）、IS-IS（Intermediate System to Intermediate System Protocol）可以根据这些字段的值进行路由决策。  
●总长度字段：占16比特。指明整个数据报的长度（以字节为单位）。最大长度为65535字节。  
●标识字段：占16比特。用来唯一地标识主机发送的每一份数据报。初值由系统随机生成通常每发一个数据报，值会加1。同一个数据报的所有分片具有相同的标识值。  
●标志位字段：占3比特。标志一份数据报是否要求分段。一位：保留　；二位：禁止分片（如果设置此位并且IP数据报长度超过MTU（帧的最大传输单元），IP模块丢弃该数据报并返回一个ICMP差错报文）；三位（MF）：后面是否有报文：有：1，没有：0  
●片偏移字段：占13比特。如果一份数据报要求分段的话，此字段指明该段偏移距原始数据报开始的位置。以8字节为偏移单位，所以，出了最后一个分片，其他前面的分片数据部分长度一定是8字节（64位）的整数倍。  
●生存时间（TTL：Time to Live）字段：占8比特。用来设置数据报最多可以经过的路由器数。由发送数据的源主机设置，通常为32、64、128等。每经过一个路由器，其值减1，直到0时该数据报被丢弃。  
●协议字段：占8比特。指明IP层所封装的上层协议类型，如ICMP（1）、IGMP（2） 、TCP（6）、UDP（17）等。  
●首部校验和字段：占16比特。只检验数据报的头部在传输过程中是否损坏。  
●源IP地址、目标IP地址字段：各占32比特。用来标明发送IP数据报文的源主机地址和接收IP报文的目标主机地址。  
●选项字段：最多包含40字节（IP头部最大60字节－20字节固定部分）。每个选项的长度必须是4字节的整数倍，如果不足，必须填充0以达到此长度要求。用来定义一些任选项：  
记录路由：数据报途经的所有路由器将自己的IP地址填入选项部分，以跟踪数据报的传递路径。  
时间戳：每个路由器将数据报被转发的时间计入选项部分，测量途径路由数据报传输的时间。  
松散源路由选择：制定一个路由器IP列表，数据报发送必须经所列表中的所有路由器。  
严格源路由器：与松散源路由选择相似，不过数据报只能经过被指定的路由器。  
ARP协议  
ICMP协议  
IGMP协议  
