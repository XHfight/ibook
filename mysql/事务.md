# 事务  
- [什么是事务](#1)  
- [为什么要有事务](#2)  
- [事务特点ACID](#3)  
- [如何实现原子性?](#4)

<h2 id="1">什么是事务?</h2>
数据库事务(Database Transaction) ，是指作为单个逻辑工作单元执行的一系列操作，<font color=red>要么完全地执行，要么完全地不执行</font>  
<h2 id="2">为什么要有事务?</h2>
A 给B转钱，A 的账户-1000元， B 的账户就要+1000元，这两个update 语句必须作为一个整体来执行，不然A 扣钱了，B 没有加钱这种情况很难处理 。
<h2 id="1">四大特点ACID</h2> 
(1)__原子性(Atomicity)__:  
事务必须是原子工作单元；事务包含的所有操作要么全部成功，要么全部失败回滚。  
(2)__一致性(Consistency)__:  
事务处理前后数据的完整性必须保持一致。
完整性是指一个数据在某个时间点完全满足数据库中约束的要求。  
(3)__隔离性(Isolation)__：  
是指多个用户访问同一个数据库时，一个用户的事务处理不能被其他用户的事务干扰，多个并发事务之间的数据要相互隔离,一个事务不能获取到另一个事务的中间状态。  
(4)__持久性(Durablility)__:  
在事务完成以后，该事务所对数据库所作的更改便持久的保存在数据库之中，并不会被回滚。  

<h2 id="4">如何实现原子性?</h2>
&emsp;&emsp; 为了实现原子性，需要通过日志：将所有对数据的更新操作都写入日志，如果一个事务中的一部分操作已经成功，但以后的操作，由于断电/系统崩溃/其它的软硬件错误而无法继续，则通过回溯日志，将已经执行成功的操作撤销，从而达到“全部操作失败”的目的。最常见的场景是，数据库系统崩溃后重启，此时数据库处于不一致的状态，必须先执行一个crash
recovery的过程：读取日志进行REDO（重演将所有已经执行成功但尚未写入到磁盘的操作，保证__持久性__），再对所有到崩溃时尚未成功提交的事务进行UNDO（撤销所有执行了一部分但尚未提交的操作，保证__原子性__）。crash
recovery结束后，数据库恢复到__一致性__状态，可以继续被使用。

